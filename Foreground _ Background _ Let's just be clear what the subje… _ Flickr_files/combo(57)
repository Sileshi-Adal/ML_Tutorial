YUI.add("hermes-template-group-creation-view",function(t,n){var a=t.Template.Handlebars.revive({1:function(t,n,a,e,s){return"\t\t\t\t\t<span>TMP We set your group to only allow safe content.</span>\n\t\t\t\t\t<span>TMP You can change this later in the group’s administration settings.</span>\n"},3:function(t,n,a,e,s){return"\t\t\t\t\t<span>TMP We set your group to allow both safe and moderate content.</span>\n\t\t\t\t\t<span>TMP You can change this later in the group’s administration settings.</span>\n"},5:function(t,n,a,e,s){return"\t\t\t\t\t<span>TMP We set your group as 18+ since the photo you’re adding has a “Restricted” safety level.</span>\n"},7:function(t,n,a,e,s){return' aria-checked="true" checked'},9:function(t,n,a,e,s){return" disabled"},11:function(t,n,a,e,s){return' aria-checked="false"'},compiler:[7,">= 4.0.0"],main:function(t,n,a,e,s){var l,i,r=null!=n?n:{},o=a.helperMissing,d=t.escapeExpression;return'<div class="group-creation-container">\n\t<header>\n\t\t<h1 class="title">'+d("function"==typeof(i=null!=(i=a.heading||(null!=n?n.heading:n))?i:o)?i.call(r,{name:"heading",hash:{},data:s}):i)+'</h1>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</header>\n\n\t<div class="group-creation-content-container">\n\t\t<div class="step-container" data-step-index="0">\n\t\t\t<div class="step-description">\n\t\t\t\t'+d((a.preventOrphansHtml||n&&n.preventOrphansHtml||o).call(r,(a.intlHTMLMessage||n&&n.intlHTMLMessage||o).call(r,{name:"intlHTMLMessage",hash:{help_url:null!=(l=null!=n?n.urls:n)?l.help:l,group_guidelines_url:null!=(l=null!=n?n.urls:n)?l.groupGuidelines:l,intlName:"groups.GROUP_CREATION_INTRO"},data:s}),{name:"preventOrphansHtml",hash:{},data:s}))+'\n\t\t\t</div>\n\t\t\t<div class="group-options group-privacy">\n\t\t\t\t<div class="radio-container public-group radio large">\n\t\t\t\t\t<input type="radio" id="public-group-radio" class="toggle-input" name="membership" aria-checked="true" checked/>\n\t\t\t\t\t<label for="public-group-radio" tabindex="0">\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t<span>'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.PUBLIC_GROUP"},data:s}))+'</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div class="radio-sub-text">\n\t\t\t\t\t\t'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.PUBLIC_GROUP_DESC_1"},data:s}))+'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="radio-container invite-only-group radio large">\n\t\t\t\t\t<input type="radio" id="invite-only-group-radio" class="toggle-input" name="membership" aria-checked="false"/>\n\t\t\t\t\t<label for="invite-only-group-radio" tabindex="0">\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t<span>'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.INVITE_ONLY_GROUP"},data:s}))+'</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div class="radio-sub-text">\n\t\t\t\t\t\t<span>'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.INVITE_ONLY_GROUP_DESC_1"},data:s}))+"</span>\n\t\t\t\t\t\t<span>"+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.INVITE_ONLY_GROUP_DESC_3"},data:s}))+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="private-group-option-container hidden">\n\t\t\t\t\t<div class="checkbox-container private-group radio switch">\n\t\t\t\t\t\t<input id="private-group" class="toggle-input" type="checkbox" aria-checked="false">\n\t\t\t\t\t\t<label for="private-group" tabindex="0">\n\t\t\t\t\t\t\t<span>'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.MAKE_GROUP_PRIVATE"},data:s}))+'</span>\n\t\t\t\t\t\t\t<div class="check-indicator square" role="checkbox"></div>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="checkbox-sub-text">\n\t\t\t\t\t\t\t<span class="desc-1">'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.PRIVATE_GROUP_DESC_1"},data:s}))+'</span>\n\t\t\t\t\t\t\t<span class="desc-2">'+d((a.preventOrphansHtml||n&&n.preventOrphansHtml||o).call(r,(a.intlHTMLMessage||n&&n.intlHTMLMessage||o).call(r,{name:"intlHTMLMessage",hash:{intlName:"groups.PRIVATE_GROUP_DESC_2"},data:s}),{name:"preventOrphansHtml",hash:{},data:s}))+'</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="step-container hidden" data-step-index="1">\n\t\t\t<div class="step-description">\n\t\t\t\t'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{lang:null!=n?n.lang:n,intlName:"groups.GROUP_NAME_DESC_INSTRUCTION"},data:s}))+'\n\t\t\t</div>\n\t\t\t<div class="group-options group-details">\n\t\t\t\t<input class="input-field group-name" type="text" placeholder="'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.GROUP_NAME_PLACEHOLDER"},data:s}))+'"/>\n\t\t\t\t<div class="error-message title-error hidden"></div>\n\t\t\t\t<textarea class="input-field group-description" placeholder="'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"groups.GROUP_DESC_PLACEHOLDER"},data:s}))+'"></textarea>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="step-container hidden" data-step-index="2">\n\t\t\t<div class="step-description">\n'+(null!=(l=(a.ifCond||n&&n.ifCond||o).call(r,null!=n?n.safetyLevel:n,"===","0",{name:"ifCond",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s}))?l:"")+(null!=(l=(a.ifCond||n&&n.ifCond||o).call(r,null!=n?n.safetyLevel:n,"===","1",{name:"ifCond",hash:{},fn:t.program(3,s,0),inverse:t.noop,data:s}))?l:"")+(null!=(l=(a.ifCond||n&&n.ifCond||o).call(r,null!=n?n.safetyLevel:n,"===","2",{name:"ifCond",hash:{},fn:t.program(5,s,0),inverse:t.noop,data:s}))?l:"")+'\t\t\t</div>\n\t\t\t<div class="group-options group-age">\n\t\t\t\t<div class="radio-container all-age-group radio large">\n\t\t\t\t\t<input type="radio" id="all-age-group" class="toggle-input" name="age"\n\t\t\t\t\t\t'+(null!=(l=(a.ifCond||n&&n.ifCond||o).call(r,null!=n?n.safetyLevel:n,"!==","2",{name:"ifCond",hash:{},fn:t.program(7,s,0),inverse:t.program(9,s,0),data:s}))?l:"")+'/>\n\t\t\t\t\t<label for="all-age-group" tabindex="0">\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t<span>TMP This group is good for all ages</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="radio-container adult-group radio large">\n\t\t\t\t\t<input type="radio" id="adult-group" class="toggle-input" name="age" '+(null!=(l=(a.ifCond||n&&n.ifCond||o).call(r,null!=n?n.safetyLevel:n,"===","2",{name:"ifCond",hash:{},fn:t.program(7,s,0),inverse:t.program(11,s,0),data:s}))?l:"")+'/>\n\t\t\t\t\t<label for="adult-group" tabindex="0">\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t<span>TMP This group is 18+</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div class="radio-sub-text">\n\t\t\t\t\t\t<span>TMP For groups that contain adult-only or sensitive content.</span>\n\t\t\t\t\t\t<a href='+d(t.lambda(null!=(l=null!=n?n.urls:n)?l.age:l,n))+' target="_blank">'+d((a.intlMessage||n&&n.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:s}))+'</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="terms-of-service">\n\t\t\t\t'+d((a.preventOrphansHtml||n&&n.preventOrphansHtml||o).call(r,(a.intlHTMLMessage||n&&n.intlHTMLMessage||o).call(r,{name:"intlHTMLMessage",hash:{comm_guidelines_url:null!=(l=null!=n?n.urls:n)?l.commGuidelines:l,terms_of_service_url:null!=(l=null!=n?n.urls:n)?l.termsOfService:l,intlName:"groups.GROUP_TERMINATION_WARNING"},data:s}),{name:"preventOrphansHtml",hash:{},data:s}))+'\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="action-container">\n\t\t<div class="error-message create-error hidden"></div>\n\t\t<div class="buttons">\n\t\t\t<button class="mini alt button-cancel">'+d("function"==typeof(i=null!=(i=a.cancelText||(null!=n?n.cancelText:n))?i:o)?i.call(r,{name:"cancelText",hash:{},data:s}):i)+'</button>\n\t\t\t<button class="mini action button-action">'+d("function"==typeof(i=null!=(i=a.createText||(null!=n?n.createText:n))?i:o)?i.call(r,{name:"createText",hash:{},data:s}):i)+"</button>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),e={};t.Array.each([],function(n){var a=t.Template.get("hermes/"+n);a&&(e[n]=a)}),t.Template.register("hermes/group-creation-view",function(n,s){return s=s||{},s.partials=s.partials?t.merge(e,s.partials):e,a(n,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("group-creation-view",function(t,e){var i=require("hermes-core/flog")(e);t.namespace("Views")[this.name]=t.Base.create("group-creation-view",t.Views["stuff-creation-view"],[],{langBundles:this.details.langBundles,initializer:function(t){var e=[{title:this.intlMessage({intlName:"add-to-stuff.CURATIONS_CREATE_A_NEW_GROUP"}),cancelText:this.intlMessage({intlName:"common.CANCEL"}),actionText:this.intlMessage({intlName:"stats.NEXT"})},{title:this.intlMessage({intlName:"add-to-stuff.ABOUT_YOUR_GROUP"}),cancelText:this.intlMessage({intlName:"stats.PREVIOUS"}),actionText:this.intlMessage({intlName:"stats.NEXT"})},{title:"TMP Group safety level",cancelText:this.intlMessage({intlName:"stats.PREVIOUS"}),actionText:"TMP Create group"}];return this.labelList=e,this.curationType="group",this.titleError=this.intlMessage({intlName:"add-to-stuff.PLEASE_ENTER_GROUP_NAME"}),this.createError=this.intlMessage({intlName:"add-to-stuff.COULDNT_SAVE_GROUP"}),this.photoId=t.photoId,this.groupOptions={ageRestriction:"0",privacy:"3",safety:"0"},this.constructor.superclass.initializer.call(this,t)},loadState:function(){var e=this;return this.photoId?this.appContext.getModel("photo-models",this.photoId).then(function(t){var i=t.getValue("safetyLevel");e.photoModel=t,e.groupOptions.safety=i?i.toString():"0"}):t.Promise.resolve()},buildContainer:function(){return this.activeStep=0,this.setContainerWithTemplate("group-creation-view",{heading:this.labelList[0].title,cancelText:this.labelList[0].cancelButton,actionText:this.labelList[0].actionButton,lang:this.appContext.lang,urls:{groupGuidelines:"/groups_guidelines.gne",help:"https://help.flickr.com/en_us/search?q=groups",age:"https://help.flickr.com/en_us/flickr-group-administration-options-SyQAnXoyQ",termsOfService:"/atos/pro",commGuidelines:"/help/guidelines"},safetyLevel:this.groupOptions.safety}),this},activate:function(){var t=this,e=this.get("container");this.headTitleNode=e.one(".title"),this.actionContainer=e.one(".action-container"),this.cancelButton=e.one(".button-cancel"),this.actionButton=e.one(".button-action"),this.closeButton=e.one(".close-x-button"),this.titleNode=e.one(".group-name"),this.descriptionNode=e.one(".group-description"),this.titleErrorNode=e.one(".error-message.title-error"),this.createErrorNode=e.one(".error-message.create-error"),this.privateGroupInput=e.one("#private-group"),this.ageRadioContainer=e.one(".group-age"),this.privacyRadioContainer=e.one(".group-privacy"),this.privateGroupOptionContainer=e.one(".private-group-option-container"),this.headTitleNode.set("text",this.labelList[0].title),this.cancelButton.set("text",this.labelList[0].cancelText),this.actionButton.set("text",this.labelList[0].actionText),this.registerEventHandler(this.privacyRadioContainer.on("change",this.handlePrivacyRadioChange.bind(this))),this.registerEventHandler(this.ageRadioContainer.on("change",this.handleAgeRadioChange.bind(this))),this.registerEventHandler(this.cancelButton.on("click",this.handleCancel.bind(this))),this.registerEventHandler(this.actionButton.on("click",this.handleAction.bind(this))),this.registerEventHandler(this.closeButton.on("click",function(){t.fire("readyToClose")}.bind(this))),this.registerEventHandler(this.titleNode.on("keyup",function(){this.titleNode.get("value")&&this.showError(this.titleErrorNode,!1)}.bind(this))),this.registerEventHandler(this.privacyRadioContainer.on("keydown",this.handlePrivacyKeyPress.bind(this))),this.registerEventHandler(this.ageRadioContainer.on("keydown",this.handleAgeKeyPress.bind(this))),this.constructor.superclass.activate.call(this,this.params)},handleCancel:function(){this.activeStep>0?this.goToStep(this.activeStep-1):this.params.inlineCreation?(this.fire("cancel"),this.resetView()):this.fire("readyToClose")},handleAction:function(){0===this.activeStep?this.goToStep(this.activeStep+1):1===this.activeStep?this.titleNode.get("value")?this.goToStep(this.activeStep+1):this.showError(this.titleErrorNode,!0,this.titleError):this.titleNode.get("value")?(this.showError(this.createErrorNode,!1),this.createCuration().then(function(t){this.fire("created",{type:this.curationType,curation:t}),this.params.inlineCreation?this.resetView():this.fire("readyToClose")}.bind(this)).catch(function(t){this.showError(this.createErrorNode,!0,this.createError)}.bind(this))):(this.goToStep(1),this.showError(this.titleErrorNode,!0,this.titleError))},handlePrivacyKeyPress:function(t){var e=t.keyCode,i=t.target.ancestor(".radio",!0).one(".toggle-input"),o=i.get("type");13===e&&("radio"===o?i.get("checked")||(i.set("checked",!0),this.handlePrivacyRadioChange(t)):(i.set("checked",!i.get("checked")),this.handlePrivacyRadioChange(t)))},handleAgeKeyPress:function(t){var e=t.keyCode,i=t.target.ancestor(".radio",!0).one(".toggle-input"),o=i.hasAttribute("disabled");13!==e||i.get("checked")||o||(i.set("checked",!0),this.handleAgeRadioChange(t))},handlePrivacyRadioChange:function(t){var e=t.target.ancestor(".radio",!0);e.hasClass("public-group")?(this.privateGroupOptionContainer.addClass("hidden"),this.privateGroupInput.set("checked",!1),this.groupOptions.privacy="3"):e.hasClass("invite-only-group")?(this.privateGroupOptionContainer.removeClass("hidden"),this.groupOptions.privacy="2"):e.hasClass("private-group")&&(e.one(".toggle-input").get("checked")?this.groupOptions.privacy="1":this.groupOptions.privacy="2")},handleAgeRadioChange:function(t){var e=t.target.get("id");"all-age-group"===e?this.groupOptions.ageRestriction="0":"adult-group"===e&&(this.groupOptions.ageRestriction="1")},goToStep:function(t){var e=this.get("container"),i=e.one('.step-container[data-step-index="'+this.activeStep+'"]'),o=e.one('.step-container[data-step-index="'+t+'"]');clearTimeout(this.goToStepTimeout),o.removeClass("hiding-left"),o.removeClass("hiding-right"),i.removeClass("showing"),i.removeClass("showing-left"),i.removeClass("showing-right"),o.removeClass("hidden"),o.addClass("showing"),t>this.activeStep?(i.addClass("hiding-left"),setTimeout(function(){o.addClass("showing-left")},0)):(i.addClass("hiding-right"),setTimeout(function(){o.addClass("showing-right")},0)),this.goToStepTimeout=setTimeout(function(){i.removeClass("hiding-left"),i.removeClass("hiding-right"),o.removeClass("showing"),o.removeClass("showing-left"),o.removeClass("showing-right"),i.addClass("hidden")},300),this.setStepValues(t),1===this.activeStep&&this.titleNode.focus()},setStepValues:function(t){var e=this;this.headTitleNode.addClass("changing"),this.actionContainer.addClass("changing"),e.setStepValuesTimeout=setTimeout(function(){e.headTitleNode.set("text",e.labelList[t].title),e.cancelButton.set("text",e.labelList[t].cancelText),e.actionButton.set("text",e.labelList[t].actionText)},300),this.setStepValuesTimeout=setTimeout(function(){e.headTitleNode.removeClass("changing"),e.actionContainer.removeClass("changing"),e.cancelButton.set("text",e.labelList[t].cancelText),e.actionButton.set("text",e.labelList[t].actionText)},600),this.activeStep=t},createNewAndAddPhoto:function(){var e,i=this,o=this.titleNode.get("value"),s=this.descriptionNode.get("value");return e={name:o,description:s,userId:this.appContext.getViewer().nsid,privacyLevel:this.groupOptions.privacy,ageRestriction:this.groupOptions.ageRestriction,safetyLevel:this.groupOptions.safety},this.appContext.getModelRegistry("group-info-models").then(function(t){return i.groupInfoModelRegistry=t,t.remote.create(e,i.appContext)}).then(function(e){return i.photoId?i.addPhoto(e.id,i.photoId).then(function(){return e}):t.Promise.resolve(e)}).catch(function(t){throw t})},addPhoto:function(t,e){var o=this;return this.appContext.getModel("group-pool-models",t).then(function(t){return o.photoModel.getValue("isOwner")?o.addToGroup(t,e):o.inviteToGroup(t,e)}).catch(function(t){i.error("Error adding photo after group creation",{err:t})})},addToGroup:function(t,e){var o=t.getValue("id");return t.addPhotoRemote(e).catch(function(s){if(6===s.code)return this.pendingGroupRegistry.addOrUpdate({id:[e,o].join("-"),photoId:e,groupId:o}),t;throw i.error("Error adding photo to group",{err:s}),s})},inviteToGroup:function(t,e){t.getValue("id");return t.invitePhotoRemote(e).catch(function(e){if(6===e.code)return t;throw i.error("Error inviting photo to group",{err:e}),e})},acceptToGroup:function(t,e){return t.acceptPhotoRemote(e)},showError:function(t,e,i){i&&t.set("text",i),e?t.removeClass("hidden"):t.addClass("hidden")},resetView:function(){this.buildContainer(),this.activate()}})},"@VERSION@",{requires:["flickr-view","stuff-creation-view","hermes-template-group-creation-view"],langBundles:["common","global-nav","stats","groups","add-to-stuff"]});YUI.add("curation-helper",function(e,o){require("hermes-core/flog")(o),e.mix({langBundles:["prints"]},e.Localizable);e.CurationHelper=function(o,i){var t=i.view;return this.showAddToCuration=function(i){var s,a=i.photoId,r=i.customConfig,n=i.anchorNode,l=void 0===i.useViewportType||i.useViewportType,u=i.containerType,d=void 0===i.showAlbums||i.showAlbums,w=void 0!==i.showGalleries&&i.showGalleries,h=void 0===i.showGroups||i.showGroups,c=i.initialTab;l&&(u=o.viewportData.getWidth()>700?"droparound":"modal"),c||(c=d?"album":"gallery"),s=r||{photoId:a,initialTab:c,showAlbums:d,showGalleries:w,showGroups:h,inlineGroupCreation:!1,dismissOnSelect:!0,dismissOnCreate:!0},"droparound"===u&&n?(this.curateView=new e.Views["add-to-stuff-view"](s),this.curateDroparound=new e.Views.FluidDroparound({appContext:o,subview:this.curateView,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:400,newReposition:!0,autoSizeToContent:!0,anchorOffsetVertical:0,anchorOffsetHorizontal:12,anchorElement:n,keyboardAnchorElement:n,contentPadding:0,preventPageScrollOnScroll:!0,useDefaultKeyboardNavigation:!1}),this.curateDroparound.show(),t.fire("curateOpened"),t.registerEventHandler(this.curateDroparound.on("closeDroparound",function(e){t.fire("curateClosed")}.bind(this)))):(s.inlineGroupCreation=!0,s.useLargeLayout=!0,s.dismissOnSelect=!1,s.dismissOnCreate=!1,this.curateView=new e.Views["add-to-stuff-view"](s),this.curateModal=new e.Views.FluidModal({appContext:o,subview:this.curateView,showCancelButton:!1,showActionButton:!1,showCancelX:!1,dismissOnOverlayClick:!0,hideModalOverlay:!0,showHeader:!1,showFooter:!1,contentPadding:0,focusOnFirstTabPress:!1}),this.curateModal.show())},this.showCreationModal=function(i){var t=i.viewName,s=i.customConfig,a=i.overlayClassList,r={appContext:o};r=Object.assign(r,s),this.creationView=new e.Views[t](r),this.creationModal=new e.Views.FluidModal({appContext:o,subview:this.creationView,dismissOnOverlayClick:!0,showHeader:!1,showFooter:!1,showButtons:!1,showCancelButton:!1,showActionButton:!1,showCancelX:!1,contentPadding:0,overlayClassList:a}),this.creationModal.show()},this}},"@VERSION@",{requires:["add-to-stuff-view","album-creation-view","gallery-creation-view","group-creation-view"]});YUI.add("infobar-photolist-photo-view",function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.PhotoListSubview,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.photoModel=e.model,this.signedIn=this.appContext.getViewer().signedIn,this.set("isActiveViewAgnostic",!0),this.hideCommentCount=e.hideCommentCount||!1,this.hideFaveCount=e.hideFaveCount||!1,this.params.displayCurate=void 0===this.params.displayCurate||this.params.displayCurate},loadState:function(){return e.Promise.all([this.appContext.getModel("photo-engagement-models",this.get("id")).then(function(e){this.engagementModel=e}.bind(this)),this.appContext.getModel("photo-models",this.get("id")).then(function(e){this.photoModel=e,this.get("model")||this.set("model",this.photoModel)}.bind(this))])},buildContainer:function(){var t,i=e.URLHelper.getPhotoPage({photoId:this.get("model").getValue("id"),pathAlias:this.get("model").getValue("owner").getValue("pathAlias"),contextSuffix:this.params.contextSuffix}),a=this.get("model"),n=a.getValue("owner"),o=a.getValue("engagement"),s={title:a.getValue("title"),isVideo:a.getValue("isVideo"),needsInterstitial:a.getValue("needsInterstitial"),mediaType:a.getValue("mediaType"),owner:{buddyicon:n.getValue("buddyicon"),pathAlias:n.getValue("pathAlias"),displayname:n.getValue("displayname"),url:n.getValue("url")},engagement:{isFaved:o.getValue("isFaved"),faveCount:this.hideFaveCount?0:o.getValue("faveCount"),commentCount:this.hideCommentCount?0:o.getValue("commentCount"),canFave:o.getValue("canFave"),viewCount:o.getValue("viewCount")}};this.get("container");t={photoPageUrl:i,photoUrl:this.get("photoUrl"),photo:s,infoBarOnHover:this.params.infoBarOnHover,showOwnerIcon:this.params.showOwnerIcon,canFave:this.signedIn&&s.engagement.canFave,displayViews:this.params.displayViews,displayCurate:this.params.displayCurate&&this.appContext.flipper.isFlipped("enable-megadroparound")&&this.signedIn},this.setContainerWithTemplate("infobar-photolist-photo",t),this.updateGeometry()},activate:function(){var t=this.get("container");this.mainContainer=t.one(".photo-list-photo-container"),this.photoContainer=t.one(".photo-container"),this.infoBar=t.one(".sub-photo-info-bar"),this.infoBarEngagement=this.infoBar.one(".engagement"),this.faveNode=this.infoBar.one(".engagement-item.fave"),this.commentNode=this.infoBar.one(".engagement-item.comment"),this.detailsNode=this.infoBar.one(".details-container"),this.avatar=this.detailsNode.one(".avatar"),this.appContext.flipper.isFlipped("enable-megadroparound")&&(this.curateNode=this.infoBar.one(".engagement-item.curate"),this.curateNode&&this.registerEventHandler(this.curateNode.on(["click","keydown"],this.handleCurateClick.bind(this)))),this.faveNode&&(this.faveCountNode=this.faveNode.one(".engagement-count")),this.faveNode&&this.registerEventHandler(this.faveNode.on(["click","key"],this.handleFaveClick.bind(this),"down:13")),this.commentNode&&(this.commentIcon=this.commentNode.one(".engagement-icon"),this.commentTextNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on(["click","key"],this.handleCommentClick.bind(this),"down:13"))),this.registerEventHandler(this.engagementModel.on("valuesChanged",this.handleEngagementModelValuesChanged.bind(this))),this.downloadCacheAndSetImage(),e.UA.ie||this.appContext.getUA().isEdge?this.updateEdgeBreakpoints():(this.updateBreakpoints(),this.registerEventHandler(e.on("resize",e.betterThrottle(this.updateBreakpoints.bind(this),500,this,!0)))),this.mainContainer.removeClass("loading")},handleFaveClick:function(t){var a,n=t.currentTarget,o=n.one(".engagement-count");this.faveNode.hasClass("can-not-fave")?this.signedIn||this.showSignUpAndFaveModal(this.get("model").getValue("id"),e.config.win.location.href):this.isFaving||(this.isFaving=!0,this.engagementModel.toggleFave(),a=this.engagementModel.getValue("faveCount"),n.toggleClass("faved",this.engagementModel.getValue("isFaved")),o.toggleClass("empty",0===a),o&&a>0?o.set("text",a):o.set("text",""),this.engagementModel.remoteUpdate().then(function(){this.isFaving=!1}.bind(this),function(e){3!==e.code&&(this.engagementModel.toggleFave(),n.toggleClass("faved",this.engagementModel.getValue("isFaved")),o&&(o.set("text",a),o.toggleClass("empty",0===a))),i.error("Error faving photo",{err:e}),this.isFaving=!1}.bind(this)))},handleCommentClick:function(){var t,i=this,a=new e.Views["photo-comments-view"]({appContext:this.appContext,photoId:this.get("model").getValue("id"),isScrollable:!0,addCommentText:this.intlMessage({intlName:"comments.ADD_PHOTO_COMMENT",mediaType:this.get("model").getValue("mediaType")})});t=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:400,height:400,newReposition:!0,autoSizeToContent:!0,anchorOffsetVertical:0,anchorOffsetHorizontal:12,classList:"infobar-photo-remark",anchorElement:this.commentIcon,keyboardAnchorElement:this.commentNode,subview:a,contentPadding:0,preventPageScrollOnScroll:!0,useDefaultKeyboardNavigation:!1}),i.registerEventHandler(e.on("addComment:showingSignupModal",function(){t.close()})),t.on("closeDroparound",function(){i.commentNode.removeClass("active"),i.infoBar.removeClass("active")}),t.show(),this.commentNode.addClass("active"),this.infoBar.addClass("active")},handleCurateClick:function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(e.halt(),this.showAddToCuration())},showAddToCuration:function(){var t=this.get("model").getValue("isOwner");new e.CurationHelper(this.appContext,{view:this}).showAddToCuration({photoId:this.get("model").getValue("id"),showAlbums:t,showGalleries:!t,anchorNode:this.curateNode})},handleEngagementModelValuesChanged:function(t){var i;t.commentCount&&(i=t.commentCount.newVal,this.commentTextNode.set("text",e.IntlNumber.format(i,this.appContext.lang,1)),this.commentTextNode.toggleClass("hidden",0===i))},updateBreakpoints:function(){var e=0;this.infoBar.addClass("invisible"),this.infoBar.removeClass("narrow"),this.photoContainer.removeClass("narrow"),this.detailsNode.removeClass("hidden"),this.commentNode.removeClass("hidden"),this.curateNode&&this.curateNode.removeClass("hidden"),this.faveNode&&(this.faveNode.removeClass("hidden"),this.faveNode.removeClass("last"),this.faveCountNode.removeClass("hidden")),this.avatar&&this.avatar.removeClass("hidden"),this.removeButtonContainer&&this.removeButtonContainer.addClass("invisible"),this.avatar&&this.detailsNode.get("clientWidth")<80&&this.avatar.addClass("hidden"),this.detailsNode.get("clientWidth")<=10&&(this.infoBar.addClass("narrow"),this.detailsNode.addClass("hidden")),this.infoBar.get("clientWidth")<this.infoBarEngagement.get("clientWidth")+16&&(this.commentNode.addClass("hidden"),this.curateNode?e=this.curateNode.get("clientWidth"):this.faveNode.addClass("last"),this.faveCountNode&&this.infoBar.get("clientWidth")<this.faveNode.get("clientWidth")+e+16&&this.faveCountNode.addClass("hidden"),this.curateNode&&this.infoBar.get("clientWidth")<this.infoBarEngagement.get("clientWidth")+e+16&&(this.curateNode.addClass("hidden"),this.faveNode.addClass("last"))),this.mainContainer.get("clientWidth")<48&&this.photoContainer.addClass("narrow"),this.infoBar.removeClass("invisible"),this.removeButtonContainer&&this.removeButtonContainer.removeClass("invisible")},updateEdgeBreakpoints:function(){this.cardWidth=this.get("layoutItem").geometry.width,this.infoBar.addClass("invisible"),this.infoBar.removeClass("narrow"),this.photoContainer.removeClass("narrow"),this.detailsNode.removeClass("hidden"),this.commentNode.removeClass("hidden"),this.faveNode&&(this.faveNode.removeClass("hidden"),this.faveNode.removeClass("last"),this.faveCountNode.removeClass("hidden")),this.avatar&&this.avatar.removeClass("hidden"),this.removeButtonContainer&&this.removeButtonContainer.addClass("invisible"),this.avatar&&this.cardWidth<236&&this.avatar.addClass("hidden"),this.cardWidth<=90&&(this.infoBar.addClass("narrow"),this.detailsNode.addClass("hidden")),this.cardWidth<156&&(this.commentNode.addClass("hidden"),this.curateNode||this.faveNode.addClass("last")),this.cardWidth<186&&(this.commentNode.addClass("hidden"),this.curateNode||this.faveNode.addClass("last"),this.faveCountNode&&this.cardWidth<116&&(this.faveCountNode.addClass("hidden"),this.faveNode.addClass("last"),this.curateNode&&this.curateNode.addClass("hidden"))),this.cardWidth<48&&this.photoContainer.addClass("narrow"),this.infoBar.removeClass("invisible"),this.removeButtonContainer&&this.removeButtonContainer.removeClass("invisible")},showSignUpAndFaveModal:function(t,i){var a,n=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),o=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});(a=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:n,signUpMessage:o,beaconPrefix:"fave"})).on("signUpClick",function(a){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:i})}),a.on("signInClick",function(a){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:i})}),a.show()},downloadCacheAndSetImage:function(){e.fluid.loadImage(this.get("photoUrl"),{timeout:1e3,retry:!0}).then(function(e){this.handleImageLoad(!0,e)}.bind(this),function(e){this.handleImageLoad(!1,e+"?retry="+Date.now())}.bind(this))},handleImageLoad:function(t,i){var a=this.get("container").one(".photo");a.setStyle("backgroundImage","url("+i+")"),t||a.setStyle("backgroundColor","#eee"),e.fluid.chill(function(){this.fire(t?"loaded":"loadError")},this),a=null}})},"@VERSION@",{requires:["photo-list-subview","photo-comments-view","add-to-stuff-view","hermes-template-infobar-photolist-photo","curation-helper"],langBundles:["common","fave-view","comments"]});YUI.add("hermes-lang-fave-view",function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:["We couldn't fave at this time"],SIGN_IN_TO_FAVE:["You must be signed in to fave. Please sign in now."],LOADING_FAVES:["Loading Faves..."],UNFAVE_PHOTO:["Unfave this photo"],FAVE_PHOTO:["Fave this photo"],WHO_FAVED:["Who faved this photo"],SIGN_IN_BEFORE_FAVE_TITLE:["You found a photo to fave!"],SIGN_IN_BEFORE_FAVE_MESSAGE:["That's great. Just sign in to fave it."],SIGN_IN_AND_FAVE:["Sign in and fave"],JOIN_FLICKR_AND_FAVE:["Join Flickr to add this photo to your favorites."]})},"@VERSION@",{requires:["intl"]});YUI.add("mega-limit-overlay-view",function(e,t){var i=require("hermes-core/analytics");e.namespace("Views")[this.name]=e.Base.create("mega-limit-overlay-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.dismissCookieName=e.config.flickr.upload_blocking.dismiss_photo_limit_overlay_cookie_name},loadState:function(){var t=this;return!this.appContext.getCookie(this.dismissCookieName)&&this.appContext.flipper.isFlipped("enable-mega-limit-overlay")&&"products-flickrpro-route"!==this.appContext.routeConfig.module&&this.appContext.getViewer().signedIn?this.appContext.getModel("person-profile-models",this.appContext.getViewer().nsid).then(function(e){t.profileModel=e}):e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("mega-limit-overlay")},activate:function(){var t=this,i=this.get("container"),o=this.getFetchParams();if(this.contentContainer=i.one(".mega-limit-overlay"),this.firstImageCard=this.contentContainer.one(".first-image-card"),this.messageContainer=this.contentContainer.one(".info-message-container"),this.profileModel&&e.UserLimitsHelper.isOverARRLimit(this.profileModel,this.appContext))return e.Promise.all([this.appContext.getModel("person-models",this.appContext.getViewer().nsid).then(function(e){t.userModel=e}),e.ListFetchers["flickr-people-getPhotos"].run(o,this.appContext).then(function(e){e&&e.length&&(t.photoModel=e[0])})]).then(function(){return t.photoModel?t.renderImageCard():e.Promise.reject()}).then(function(){t.isLoaded=!0,t.fire("loaded"),t.show()})},resizeImage:function(e,t){var i,o,a,n=this.photoModel.getValue("oWidth")/this.photoModel.getValue("oHeight");e=e||500,t=t||430,i=this.contentContainer.get("clientHeight"),(a=(o=Math.min(t,i-70))*n)>e&&(o=(a=e)/n),this.firstImageCard.setStyle("height",o+70),this.firstImageCard.setStyle("width",a),this.photoCardView.updateGeometry({aspectRatio:n,geometry:{width:a,height:o+70,top:0,left:0},isAwake:!0}),this.photoCardView.updateBreakpoints()},renderImageCard:function(){var t=this;return this.photoCardView=new e.Views["infobar-photolist-photo-view"]({appContext:this.appContext,id:this.photoModel.getValue("id"),layoutItem:{aspectRatio:this.photoModel.getValue("oWidth")/this.photoModel.getValue("oHeight"),geometry:{width:this.photoModel.getValue("oWidth"),height:this.photoModel.getValue("oHeight"),top:0,left:0},isAwake:!0},displayViews:!0,displayCurate:!1}),this.photoCardView.initialize().then(function(){return t.firstImageCard.append(t.photoCardView.get("container")),t.photoCardView.activate()})},getFetchParams:function(){return{perPage:1,page:1,userId:this.appContext.getViewer().nsid,orderBy:"date-posted-asc"}},show:function(){var t,o=this,a=this.get("container"),n=Math.min(500,o.appContext.viewportData.getWidth()),s=e.config.flickr.account.photo_limit,r=e.UserLimitsHelper.getARRCount(this.profileModel);t=Math.max(r-s,0).toLocaleString(this.appContext.lang,{maximumFractionDigits:0}),this.messageContainer.append(this.templates("mega-limit-overlay-message")({overLimitCountString:t,rulesUrl:"https://blog.flickr.net/en/2018/12/17/important-service-updates-and-dates-to-remember/",acceptUrl:"/account/upgrade/pro?select",username:this.userModel.getValue("username")})),this.acceptButton=this.contentContainer.one(".accept-button"),this.declineButton=this.contentContainer.one(".decline-button"),a.addClass("displayed"),setTimeout(function(){a.addClass("active"),e.one("body").addClass("locked-for-overlay-scroll")},50),o.resizeImage(n),o.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(function(e){var t=Math.min(500,o.appContext.viewportData.getWidth());o.resizeImage(t)},20,null,!0))),o.registerEventHandler(this.acceptButton.on("click",function(e){o.handleAcceptClick(e)})),o.registerEventHandler(this.declineButton.on("click",function(e){o.handleDeclineClick(e)})),i&&i.tl(!0,"o","Photo Limit Takeover: Show")},hide:function(){var t=this.get("container");e.one("body").removeClass("locked-for-overlay-scroll"),t.removeClass("active"),setTimeout(function(){t.removeClass("displayed")},1e3)},handleAcceptClick:function(t){this.hide(),i&&i.tl(e.one(t.target).getDOMNode(),"o","Photo Limit Takeover: Accept",null,"navigate")},handleDeclineClick:function(t){var o=new Date;o.setTime(o.getTime()+36e10),this.appContext.setCookie({cookieName:this.dismissCookieName,cookieValue:1,expires:o,path:"/"}),this.appContext.setCookie({cookieName:e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name,cookieValue:1,expires:o,path:"/"}),i&&i.tl(!0,"o","Photo Limit Takeover: Decline"),this.hide()}})},"@VERSION@",{requires:["flickr-view","hermes-template-mega-limit-overlay","hermes-template-mega-limit-overlay-message","person-public-profile-models","intl-number","user-limits-helper","string-helper","api-helper","infobar-photolist-photo-view"],langBundles:["common","upload-blocking"]});YUI.add("banner-view",function(i,e){var n=require("hermes-core/flog")(e);i.FlickrView.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.params=i,this.subview=this.params.subview},loadState:function(){return i.Promise.resolve()},buildContainer:function(){},activate:function(){var i=this,e=this.get("container");if(this.subviewParent=e,this.subview)return this.subview.on("dismiss",function(e){i.dismiss()}),this.setupSubview()},setupSubview:function(){var i=this;return this.subview.initialize().then(function(){var e=i.subview.get("container");{if("canShowBanner"in i.subview)return i.subview.canShowBanner()?(i.subviewParent.empty(),i.subviewParent.appendChild(e),i.subview.activate()):void i.dismiss();n.warn("Banners should implement method canShowBanner")}}).then(function(){i.fire("subviewActivated")})},dismiss:function(){this.get("container").remove(),this.fire("dismissed"),this.destroy()}})},"@VERSION@",{requires:["flickr-view"],langBundles:["common"]});YUI.add("hermes-template-basic-banner",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,t,s){return'\t\t\t<a role="button" class="button dismiss">\n\t\t\t\t<svg class="icon icon-close"><use xlink:href="#icon-close"></use></svg>\n\t\t\t</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,a,n,t,s){var r,i,l=null!=a?a:{},d=n.helperMissing,c=e.escapeExpression;return'<div class="basic-banner '+c("function"==typeof(i=null!=(i=n.additionalClasses||(null!=a?a.additionalClasses:a))?i:d)?i.call(l,{name:"additionalClasses",hash:{},data:s}):i)+'">\n\t<div class="banner-content fluid-centered">\n\t\t<div class="message-container">\n\t\t\t'+c((n.renderTrustedMarkup||a&&a.renderTrustedMarkup||d).call(l,null!=a?a.message:a,{name:"renderTrustedMarkup",hash:{},data:s}))+'\n\t\t</div>\n\t\t<div class="button-container">\n'+(null!=(r=n.if.call(l,null!=a?a.hideDismiss:a,{name:"if",hash:{},fn:e.noop,inverse:e.program(1,s,0),data:s}))?r:"")+"\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),t={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(t[a]=n)}),e.Template.register("hermes/basic-banner",function(a,s){return s=s||{},s.partials=s.partials?e.merge(t,s.partials):t,n(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});